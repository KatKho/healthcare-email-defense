<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVMC SecureMail Guardian - IT Administrator Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #0073cc 0%, #005699 100%);
            --secondary-gradient: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            --success-gradient: linear-gradient(135deg, #2d8c3c 0%, #1f672c 100%);
            --danger-gradient: linear-gradient(135deg, #d93737 0%, #b22b2b 100%);
            --warning-gradient: linear-gradient(135deg, #f0ad4e 0%, #d99a3e 100%);
            --info-gradient: linear-gradient(135deg, #5bc0de 0%, #46b8da 100%);
            --dark-bg: #f5f6fa;
            --card-bg: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #495057;
            --border-color: #dee2e6;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            font-size: 14px;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
        }

        /* Enhanced Hospital Header */
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d2238 100%);
            color: white;
            padding: 0;
            margin-bottom: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .header-top {
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 24px;
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-main {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hospital-branding {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hospital-logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #0d2238;
            font-size: 0.85rem;
        }

        .system-info h1 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .system-info .system-subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
            color: #b8d4f1;
        }

        .user-session {
            text-align: right;
        }

        .user-session .user-name {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .user-session .user-role {
            font-size: 0.8rem;
            color: #b8d4f1;
            margin-bottom: 2px;
        }

        .user-session .session-info {
            font-size: 0.75rem;
            color: #94b8d8;
        }

        .system-status-bar {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 24px;
            display: flex;
            gap: 30px;
            font-size: 0.8rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
        }

        .status-indicator.warning {
            background: #f59e0b;
        }

        .status-indicator.danger {
            background: #ef4444;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid #e5e7eb;
            padding: 0;
            margin: 0;
        }

        .tab-btn {
            flex: 0 0 auto;
            padding: 14px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .tab-btn:hover {
            background: #f3f4f6;
            color: #0073cc;
        }

        .tab-btn.active {
            color: #0073cc;
            border-bottom-color: #0073cc;
            background: #f0f7ff;
        }

        .tab-content {
            display: none;
            padding: 24px;
            background: var(--dark-bg);
        }

        .tab-content.active {
            display: block;
        }

        /* Cards and Widgets */
        .dashboard-widget {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .dashboard-widget h3 {
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        /* Input Section */
        .input-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .input-section h2 {
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .input-section p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 10px 12px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #0073cc;
            box-shadow: 0 0 0 3px rgba(0, 115, 204, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .analyze-btn {
            background: #0073cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .analyze-btn:hover {
            background: #005699;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 115, 204, 0.3);
        }

        /* Results Section */
        .results-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow);
        }

        .classification-result {
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .classification-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .classification-urgent {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .classification-safe {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .classification-phishing {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        /* Loading spinner */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 20px 0;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #0073cc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Test Cases */
        .test-cases {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 24px;
            margin-top: 24px;
            box-shadow: var(--shadow);
        }

        .test-case {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 14px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .test-case:hover {
            background: white;
            border-color: #0073cc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-case.urgent {
            border-left: 3px solid #dc2626;
        }

        .test-case.safe {
            border-left: 3px solid #059669;
        }

        .test-case.phishing {
            border-left: 3px solid #f59e0b;
        }

        /* Better text contrast for dark backgrounds */
        .metric-card, .dashboard-widget {
            background: white;
            color: var(--text-primary);
        }

        .reasoning {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
        }

        .reasoning h4 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1rem;
            font-weight: 600;
        }

        .reasoning p {
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* Hospital-specific styling */
        .hospital-badge {
            background: #fef3c7;
            color: #92400e;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .header-main {
                flex-direction: column;
                gap: 16px;
            }

            .user-session {
                text-align: left;
            }

            .nav-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }

            .tab-btn {
                flex: 0 0 auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Enhanced Hospital IT Header -->
        <div class="header">
            <div class="header-top">
                <div>Network: EVMC-SECURE | Environment: PRODUCTION</div>
                <div>Help Desk: ext. 4357 | On-Call: Dr. Lee</div>
            </div>
            <div class="header-main">
                <div class="hospital-branding">
                    <div class="hospital-logo">EVMC</div>
                    <div class="system-info">
                        <h1>SecureMail Guardian™</h1>
                        <div class="system-subtitle">Healthcare Email Defense System v2.4.1</div>
                    </div>
                </div>
                <div class="user-session">
                    <div class="user-name">Michael Chen</div>
                    <div class="user-role">IT Security Administrator | Level 2</div>
                    <div class="session-info">Session: 2h 14m | Last action: 2 min ago</div>
                    <div style="margin-top: 4px; padding-top: 4px; border-top: 1px solid rgba(255,255,255,0.2);">
                        <span id="currentShiftDisplay" style="color: white; font-weight: 600;">Day Shift</span>
                        <span id="shiftTimeDisplay" style="color: #b8d4f1; font-size: 0.75rem; margin-left: 8px;">7:00 AM - 3:00 PM</span>
                    </div>
                </div>
            </div>
            <div class="system-status-bar">
                <div class="status-item">
                    <span class="status-indicator"></span>
                    <span>Email Gateway: Active</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator"></span>
                    <span>AI Engine: Online</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator warning"></span>
                    <span>Queue: 3 pending</span>
                </div>
                <div class="status-item">
                    <span class="status-indicator"></span>
                    <span>HIPAA Mode: Enabled</span>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('analysis')">Email Analysis</button>
            <button class="tab-btn" onclick="showTab('generator')">Test Generator</button>
            <button class="tab-btn" onclick="showTab('dashboard')">Shift Dashboard</button>
            <button class="tab-btn" onclick="showTab('evaluation')">Performance</button>
            <button class="tab-btn" onclick="showTab('history')">Activity Log</button>
            <button class="tab-btn" onclick="showTab('quarantine')">Quarantine</button>
        </div>

        <!-- Email Analysis Tab -->
        <div id="analysis" class="tab-content active">
            <div class="input-section">
                <h2>Email Security Analysis</h2>
                <p>Analyze emails for urgency classification and phishing detection</p>
                
                <div class="form-group">
                    <label for="sender">Sender Email:</label>
                    <input type="text" id="sender" placeholder="e.g., dr.smith@emergency.hospital.org">
                </div>

                <div class="form-group">
                    <label for="subject">Subject Line:</label>
                    <input type="text" id="subject" placeholder="e.g., URGENT: Patient Code Blue - ICU">
                </div>

                <div class="form-group">
                    <label for="emailBody">Email Body:</label>
                    <textarea id="emailBody" placeholder="Paste email content here..."></textarea>
                </div>

                <button class="analyze-btn" onclick="analyzeEmail()">
                    Analyze Email
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing email patterns...</p>
            </div>

            <!-- Loading indicator for API calls -->
            <div id="loadingIndicator" style="display: none; text-align: center; padding: 20px;">
                <div class="spinner"></div>
                <p>Analyzing email content...</p>
            </div>

            <!-- Analysis results container for API responses -->
            <div id="analysisResults"></div>

            <div class="results-section" id="results" style="display: none;">
                <h3>Analysis Results</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div class="classification-result">
                        <h4 style="margin-bottom: 12px; font-size: 1rem;">Urgency Status</h4>
                        <div class="classification-badge" id="urgencyClassificationBadge">Analyzing...</div>
                        <div id="urgencyLevel" style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);"></div>
                    </div>

                    <div class="classification-result">
                        <h4 style="margin-bottom: 12px; font-size: 1rem;">Security Status</h4>
                        <div class="classification-badge" id="phishingClassificationBadge">Analyzing...</div>
                        <div id="phishingLevel" style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);"></div>
                    </div>
                </div>

                <div style="padding: 16px; background: #f8f9fa; border-radius: 6px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-weight: 500;">Confidence Score:</span>
                        <div style="flex: 1; height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
                            <div class="confidence-fill" id="confidenceBar" style="height: 100%; background: #0073cc; transition: width 0.5s ease;"></div>
                        </div>
                        <span id="confidenceValue" style="font-weight: 600;">0%</span>
                    </div>
                </div>

                <div class="reasoning">
                    <h4>Analysis Details</h4>
                    <p id="reasoningText"></p>
                </div>

                <div style="margin-top: 20px; padding: 16px; background: #f0f9ff; border: 1px solid #bfdbfe; border-radius: 6px;">
                    <h4 style="margin-bottom: 12px; font-size: 1rem;">Provide Feedback</h4>
                    <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 16px;">Help improve accuracy by confirming the analysis results</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button class="analyze-btn" onclick="provideFeedback(true, 'urgency')" style="background: #059669;">
                            Urgency: Correct
                        </button>
                        <button class="analyze-btn" onclick="provideFeedback(false, 'urgency')" style="background: #dc2626;">
                            Urgency: Incorrect
                        </button>
                        <button class="analyze-btn" onclick="provideFeedback(true, 'phishing')" style="background: #059669;">
                            Security: Correct
                        </button>
                        <button class="analyze-btn" onclick="provideFeedback(false, 'phishing')" style="background: #dc2626;">
                            Security: Incorrect
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Cases -->
            <div class="test-cases">
                <h3>Test Scenarios</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px;">
                    <div class="test-case urgent" onclick="loadTestEmail('urgent1')">
                        <div style="font-weight: 600;">URGENT: Patient Code Blue - ICU</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">nurse.smith@icu.hospital.org</div>
                    </div>
                    <div class="test-case urgent" onclick="loadTestEmail('urgent2')">
                        <div style="font-weight: 600;">Emergency Surgery Update Required</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">dr.johnson@emergency.hospital.org</div>
                    </div>
                    <div class="test-case safe" onclick="loadTestEmail('safe1')">
                        <div style="font-weight: 600;">Monthly Staff Meeting Reminder</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">admin@hospital.org</div>
                    </div>
                    <div class="test-case phishing" onclick="loadTestEmail('phishing1')">
                        <div style="font-weight: 600;">URGENT: HIPAA Compliance Verification</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">urgent@medical-alert.net</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <!-- Shift Handover Section -->
            <div class="dashboard-widget">
                <h3>Shift Handover Log</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <!-- Queue Status and Review -->
                    <div>
                        <h4 style="font-size: 0.95rem; margin-bottom: 12px; color: var(--text-primary);">Queue Review Status</h4>
                        <div style="background: #f8f9fa; border-radius: 6px; padding: 16px;">
                            <!-- Queue counts -->
                            <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #e5e7eb;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-weight: 600;">Current Queue Status</span>
                                    <span id="totalInQueue" style="font-weight: 600; color: #0073cc;">0 emails</span>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 12px;">
                                    <div style="text-align: center; padding: 8px; background: white; border-radius: 4px;">
                                        <div id="newCount" style="font-size: 1.2rem; font-weight: 600; color: #0073cc;">0</div>
                                        <div style="font-size: 0.75rem; color: var(--text-secondary);">New</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: white; border-radius: 4px;">
                                        <div id="reviewCount" style="font-size: 1.2rem; font-weight: 600; color: #f59e0b;">0</div>
                                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Reviewing</div>
                                    </div>
                                    <div style="text-align: center; padding: 8px; background: white; border-radius: 4px;">
                                        <div id="escalatedCount" style="font-size: 1.2rem; font-weight: 600; color: #dc2626;">0</div>
                                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Escalated</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Last review info -->
                            <div style="margin-bottom: 16px;">
                                <strong style="display: block; margin-bottom: 8px;">Last Queue Review:</strong>
                                <div id="lastReviewDetails" style="padding: 10px; background: white; border-radius: 4px; font-size: 0.85rem; color: var(--text-secondary);">
                                    No reviews logged today
                                </div>
                            </div>
                            
                            <!-- Review history -->
                            <div style="margin-bottom: 12px;">
                                <strong style="display: block; margin-bottom: 8px;">Recent Reviews (Last 24h):</strong>
                                <div id="reviewHistory" style="max-height: 100px; overflow-y: auto; padding: 10px; background: white; border-radius: 4px; font-size: 0.8rem;">
                                    <div style="color: var(--text-secondary);">No previous reviews</div>
                                </div>
                            </div>
                            
                            <!-- Log review button -->
                            <button class="analyze-btn" onclick="logQueueReview()" style="width: 100%; padding: 10px;">
                                Log Queue Review
                            </button>
                        </div>
                    </div>
                    
                    <!-- Shift Notes -->
                    <div>
                        <h4 style="font-size: 0.95rem; margin-bottom: 12px; color: var(--text-primary);">Handover Notes</h4>
                        <div style="background: #f8f9fa; border-radius: 6px; padding: 16px;">
                            <div style="margin-bottom: 12px;">
                                <label style="font-size: 0.85rem; font-weight: 500;">Items Reviewed:</label>
                                <input type="text" id="itemsReviewed" placeholder="e.g., 3 urgent emails, 2 phishing attempts" style="width: 100%; margin-top: 4px;">
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <label style="font-size: 0.85rem; font-weight: 500;">Unresolved Issues:</label>
                                <input type="text" id="unresolvedIssues" placeholder="e.g., Awaiting verification for sender@external.org" style="width: 100%; margin-top: 4px;">
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <label style="font-size: 0.85rem; font-weight: 500;">Suspicious Patterns:</label>
                                <textarea id="suspiciousPatterns" placeholder="Note any unusual activity or patterns..." style="width: 100%; margin-top: 4px; min-height: 80px;"></textarea>
                            </div>
                            
                            <button class="analyze-btn" onclick="saveShiftNotes()" style="width: 100%; padding: 10px; margin-bottom: 12px;">
                                Save Handover Notes
                            </button>
                            
                            <div style="padding: 10px; background: white; border-radius: 4px; font-size: 0.8rem;">
                                <strong>Previous Shift Notes:</strong>
                                <div id="previousNotesContent" style="color: var(--text-secondary); margin-top: 4px;">
                                    No notes from previous shift
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Email Safety Incident Log -->
            <div class="dashboard-widget">
                <h3>Email Safety Incident Log</h3>
                
                <div style="margin-bottom: 16px; padding: 12px; background: #f0f9ff; border-radius: 6px; border: 1px solid #bfdbfe;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>System Status:</strong>
                            <span id="systemStatus" style="color: #059669; margin-left: 8px;">No incidents — automation active</span>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            False alarms (7 days): <strong id="falseAlarmCount">0</strong> | 
                            Missed urgent: <strong id="missedUrgentCount">0</strong>
                        </div>
                    </div>
                </div>
                
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                        <thead>
                            <tr style="background: #f3f4f6; border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 10px; text-align: left;">Time</th>
                                <th style="padding: 10px; text-align: left;">Email Type</th>
                                <th style="padding: 10px; text-align: left;">AI Action</th>
                                <th style="padding: 10px; text-align: left;">Human Override</th>
                                <th style="padding: 10px; text-align: left;">Outcome</th>
                                <th style="padding: 10px; text-align: left;">Notes</th>
                            </tr>
                        </thead>
                        <tbody id="incidentLogBody">
                            <tr>
                                <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-secondary);">
                                    No incidents logged — system operating normally
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; font-size: 0.85rem;">
                        <div>
                            <strong>Total Reviews:</strong>
                            <div id="totalReviews" style="font-size: 1.2rem; color: var(--text-primary);">0</div>
                        </div>
                        <div>
                            <strong>Human Overrides:</strong>
                            <div id="humanOverrides" style="font-size: 1.2rem; color: var(--text-primary);">0</div>
                        </div>
                        <div>
                            <strong>False Positives:</strong>
                            <div id="falsePositives" style="font-size: 1.2rem; color: #dc2626;">0</div>
                        </div>
                        <div>
                            <strong>False Negatives:</strong>
                            <div id="falseNegatives" style="font-size: 1.2rem; color: #dc2626;">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Health -->
            <div class="dashboard-widget">
                <h3>System Health Monitor</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem;">Email Gateway</span>
                            <span style="color: #059669; font-weight: 600;">Active</span>
                        </div>
                    </div>
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem;">AI Engine</span>
                            <span style="color: #059669; font-weight: 600;">Online</span>
                        </div>
                    </div>
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem;">Processing Time</span>
                            <span style="font-weight: 600;">&lt;2s avg</span>
                        </div>
                    </div>
                    <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.85rem;">Emails Today</span>
                            <span id="emailsToday" style="font-weight: 600;">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Other tabs remain similar but with improved styling... -->
        <div id="generator" class="tab-content">
            <div class="dashboard-widget">
                <h3>Email Test Generator</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Generate test emails to validate the AI classification system</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                    <button class="analyze-btn" onclick="generateEmail('urgent')" style="background: #dc2626;">
                        Generate Urgent
                    </button>
                    <button class="analyze-btn" onclick="generateEmail('safe')" style="background: #059669;">
                        Generate Safe
                    </button>
                    <button class="analyze-btn" onclick="generateEmail('phishing')" style="background: #f59e0b;">
                        Generate Phishing
                    </button>
                </div>
                
                <div id="generatedEmail" style="display: none; margin-top: 20px;">
                    <h4>Generated Email:</h4>
                    <div style="background: #f8f9fa; border-radius: 6px; padding: 16px; margin-top: 12px;">
                        <div style="margin-bottom: 12px;">
                            <label style="font-weight: 500; font-size: 0.85rem;">Sender:</label>
                            <div id="genSender" style="padding: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 4px; margin-top: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label style="font-weight: 500; font-size: 0.85rem;">Subject:</label>
                            <div id="genSubject" style="padding: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 4px; margin-top: 4px;"></div>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label style="font-weight: 500; font-size: 0.85rem;">Body:</label>
                            <div id="genBody" style="padding: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 4px; margin-top: 4px; white-space: pre-wrap; min-height: 100px;"></div>
                        </div>
                        <button class="analyze-btn" onclick="loadGeneratedEmail()">
                            Load into Analyzer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="evaluation" class="tab-content">
            <div class="dashboard-widget">
                <h3>Performance Metrics</h3>
                <p>Classification accuracy and feedback analysis</p>
            </div>
        </div>

        <div id="history" class="tab-content">
            <div class="dashboard-widget">
                <h3>Activity Log</h3>
                <div id="historyList">
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No activity recorded yet
                    </p>
                </div>
            </div>
        </div>

        <div id="quarantine" class="tab-content">
            <div class="dashboard-widget">
                <h3>Quarantine Queue</h3>
                <div id="quarantineList">
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No emails in quarantine
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Core functionality
        let emailHistory = [];
        let incidentLog = [];
        let reviewHistory = [];
        let queueStatus = {
            new: 0,
            reviewing: 0,
            escalated: 0
        };
        
        // Test email data
        const testEmails = {
            urgent1: {
                sender: "nurse.smith@icu.hospital.org",
                subject: "URGENT: Patient Code Blue - ICU",
                body: "CODE BLUE ALERT - ICU UNIT 3\n\nPatient requiring immediate assistance.\nAll available staff report to ICU-312."
            },
            urgent2: {
                sender: "dr.johnson@emergency.hospital.org",
                subject: "Emergency Surgery Update Required",
                body: "Emergency surgical case requiring immediate attention.\nPatient scheduled for OR 2."
            },
            safe1: {
                sender: "admin@hospital.org",
                subject: "Monthly Staff Meeting Reminder",
                body: "Reminder: Monthly department meeting next Friday at 2:00 PM."
            },
            phishing1: {
                sender: "urgent@medical-alert.net",
                subject: "URGENT: HIPAA Compliance Verification",
                body: "Your facility has been flagged. Click here to verify compliance immediately."
            }
        };

        // Initialize shift display on page load
        function initializeShiftDisplay() {
            updateShiftDisplay();
            setInterval(updateShiftDisplay, 60000); // Update every minute
        }

        function updateShiftDisplay() {
            const hour = new Date().getHours();
            let shift, shiftTime;
            
            if (hour >= 7 && hour < 15) {
                shift = "Day Shift";
                shiftTime = "7:00 AM - 3:00 PM";
            } else if (hour >= 15 && hour < 23) {
                shift = "Evening Shift";
                shiftTime = "3:00 PM - 11:00 PM";
            } else {
                shift = "Night Shift";
                shiftTime = "11:00 PM - 7:00 AM";
            }
            
            const shiftDisplay = document.getElementById('currentShiftDisplay');
            const timeDisplay = document.getElementById('shiftTimeDisplay');
            if (shiftDisplay) shiftDisplay.textContent = shift;
            if (timeDisplay) timeDisplay.textContent = shiftTime;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function loadTestEmail(testId) {
            const email = testEmails[testId];
            document.getElementById('sender').value = email.sender;
            document.getElementById('subject').value = email.subject;
            document.getElementById('emailBody').value = email.body;
        }

        function analyzeEmail() {
            // Get email content from form fields
            const sender = document.getElementById('sender').value;
            const subject = document.getElementById('subject').value;
            const body = document.getElementById('emailBody').value;

            // Validate input
            if (!sender || !subject || !body) {
                alert('Please fill in all fields');
                return;
            }

            // Combine fields into full email content for API
            const emailContent = `From: ${sender}\nSubject: ${subject}\n\n${body}`;

            // Get context type (if there's a select box)
            const contextSelect = document.getElementById('contextType');
            const context = contextSelect ? contextSelect.value : 'general';

            // Show loading state
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('analysisResults').innerHTML = '';

            // Simulate adding to queue
            queueStatus.new++;
            updateQueueDisplay();

            // Call API analysis function
            analyzeEmailWithAPI(emailContent, context)
                .then((apiData) => {
                    // API call successful - results are already displayed by analyzeEmailWithAPI
                    // Log to history
                    emailHistory.push({
                        timestamp: new Date(),
                        sender: sender,
                        subject: subject,
                        analysis: {
                            isUrgent: apiData.urgencyLevel === 'high' || apiData.urgencyLevel === 'medium',
                            isPhishing: false, // API will determine this
                            confidence: 85,
                            reasoning: `API Analysis: ${apiData.recommendedAction || 'Analysis complete'}`
                        },
                        apiData: apiData
                    });
                    
                    // Update incident log
                    updateIncidentLog({
                        isUrgent: apiData.urgencyLevel === 'high' || apiData.urgencyLevel === 'medium',
                        isPhishing: false,
                        confidence: 85
                    });
                    
                    document.getElementById('loading').style.display = 'none';
                })
                .catch((error) => {
                    // API call failed - fall back to local simulation
                    console.warn('API call failed, using local simulation:', error);
                    
                    setTimeout(() => {
                        const analysis = performAnalysis(sender, subject, body);
                        displayResults(analysis);
                        
                        // Log to history
                        emailHistory.push({
                            timestamp: new Date(),
                            sender: sender,
                            subject: subject,
                            analysis: analysis
                        });
                        
                        updateIncidentLog(analysis);
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('results').style.display = 'block';
                    }, 1000);
                });
        }

        function performAnalysis(sender, subject, body) {
            let isUrgent = false;
            let isPhishing = false;
            let confidence = 75;

            // Simple pattern matching
            if (/urgent|emergency|critical|stat|code/i.test(subject) || /urgent|emergency|critical|stat|code/i.test(body)) {
                isUrgent = true;
                confidence = 85;
            }

            if (/click here|verify|expire|suspend/i.test(body) && !sender.includes('@hospital.org')) {
                isPhishing = true;
                confidence = 90;
            }

            return {
                isUrgent: isUrgent,
                isPhishing: isPhishing,
                confidence: confidence,
                reasoning: `Analyzed ${body.length} characters. Found ${isUrgent ? 'urgent' : 'non-urgent'} patterns. ${isPhishing ? 'Phishing indicators detected.' : 'No security threats found.'}`
            };
        }

        function displayResults(analysis) {
            const urgencyBadge = document.getElementById('urgencyClassificationBadge');
            const phishingBadge = document.getElementById('phishingClassificationBadge');
            
            urgencyBadge.textContent = analysis.isUrgent ? 'URGENT' : 'ROUTINE';
            urgencyBadge.className = 'classification-badge ' + (analysis.isUrgent ? 'classification-urgent' : 'classification-safe');
            
            phishingBadge.textContent = analysis.isPhishing ? 'THREAT DETECTED' : 'SAFE';
            phishingBadge.className = 'classification-badge ' + (analysis.isPhishing ? 'classification-phishing' : 'classification-safe');
            
            document.getElementById('urgencyLevel').textContent = analysis.isUrgent ? 'Requires immediate attention' : 'Normal processing';
            document.getElementById('phishingLevel').textContent = analysis.isPhishing ? 'Security threat - quarantine recommended' : 'No threats detected';
            
            document.getElementById('confidenceBar').style.width = analysis.confidence + '%';
            document.getElementById('confidenceValue').textContent = analysis.confidence + '%';
            document.getElementById('reasoningText').textContent = analysis.reasoning;
        }

        function provideFeedback(isCorrect, type) {
            if (!isCorrect) {
                // Log incident
                const lastEmail = emailHistory[emailHistory.length - 1];
                if (lastEmail) {
                    incidentLog.push({
                        time: new Date(),
                        emailType: lastEmail.analysis.isUrgent ? 'Urgent' : 'Routine',
                        aiAction: type === 'urgency' ? 
                            (lastEmail.analysis.isUrgent ? 'Flagged Urgent' : 'Marked Routine') :
                            (lastEmail.analysis.isPhishing ? 'Flagged Phishing' : 'Marked Safe'),
                        humanOverride: 'Yes',
                        outcome: type === 'urgency' ? 'Urgency Misclassified' : 'Security Misclassified',
                        notes: `Corrected by admin`
                    });
                    updateIncidentTable();
                }
            }
            alert('Thank you for your feedback. This helps improve the system.');
        }

        function updateIncidentLog(analysis) {
            // Update dashboard status
            const totalEmails = emailHistory.length;
            document.getElementById('emailsToday').textContent = totalEmails;
        }

        function updateIncidentTable() {
            const tbody = document.getElementById('incidentLogBody');
            if (incidentLog.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding: 20px; text-align: center; color: var(--text-secondary);">No incidents logged — system operating normally</td></tr>';
                return;
            }
            
            let html = '';
            incidentLog.slice(-10).reverse().forEach(incident => {
                html += `
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                        <td style="padding: 10px;">${incident.time.toLocaleTimeString()}</td>
                        <td style="padding: 10px;">${incident.emailType}</td>
                        <td style="padding: 10px;">${incident.aiAction}</td>
                        <td style="padding: 10px;">${incident.humanOverride}</td>
                        <td style="padding: 10px;">${incident.outcome}</td>
                        <td style="padding: 10px;">${incident.notes}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
            
            // Update counts
            const falsePositives = incidentLog.filter(i => i.outcome.includes('Misclassified')).length;
            document.getElementById('falsePositives').textContent = falsePositives;
            document.getElementById('falseAlarmCount').textContent = falsePositives;
            document.getElementById('humanOverrides').textContent = incidentLog.length;
            document.getElementById('totalReviews').textContent = emailHistory.length;
            
            // Update system status
            if (falsePositives > 5) {
                document.getElementById('systemStatus').textContent = 'Multiple incidents — review required';
                document.getElementById('systemStatus').style.color = '#dc2626';
            }
        }

        function logQueueReview() {
            // Show confirmation dialog
            const confirmMessage = queueStatus.new > 0 ? 
                `Confirm you have reviewed all ${queueStatus.new + queueStatus.reviewing + queueStatus.escalated} quarantine emails for this shift?` :
                'Confirm queue review complete (no pending emails)?';
                
            if (confirm(confirmMessage)) {
                const now = new Date();
                const adminNames = ['M. Chen', 'J. Lee', 'S. Smith', 'K. Johnson', 'R. Patel'];
                const currentAdmin = adminNames[Math.floor(Math.random() * adminNames.length)];
                
                // Create review record
                const reviewRecord = {
                    timestamp: now,
                    reviewer: currentAdmin,
                    itemsCleared: queueStatus.new,
                    status: queueStatus.new > 0 ? `${queueStatus.new} pending emails cleared` : 'No pending emails'
                };
                
                // Add to review history
                reviewHistory.unshift(reviewRecord);
                if (reviewHistory.length > 10) reviewHistory.pop(); // Keep only last 10 reviews
                
                // Update last review display
                document.getElementById('lastReviewDetails').innerHTML = `
                    <strong style="color: #059669;">✓</strong> Reviewed by ${currentAdmin} at ${now.toLocaleTimeString()}<br>
                    <span style="font-size: 0.8rem;">${reviewRecord.status}</span>
                `;
                
                // Update review history display
                updateReviewHistoryDisplay();
                
                // Clear queue counts
                queueStatus.new = 0;
                queueStatus.reviewing = 0;
                updateQueueDisplay();
                
                // Save to localStorage
                localStorage.setItem('reviewHistory', JSON.stringify(reviewHistory));
            }
        }

        function updateReviewHistoryDisplay() {
            const historyDiv = document.getElementById('reviewHistory');
            if (reviewHistory.length === 0) {
                historyDiv.innerHTML = '<div style="color: var(--text-secondary);">No previous reviews</div>';
                return;
            }
            
            let html = '';
            // Filter reviews from last 24 hours
            const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);
            const recentReviews = reviewHistory.filter(r => new Date(r.timestamp) > oneDayAgo);
            
            if (recentReviews.length === 0) {
                historyDiv.innerHTML = '<div style="color: var(--text-secondary);">No reviews in last 24 hours</div>';
                return;
            }
            
            recentReviews.forEach(review => {
                const time = new Date(review.timestamp);
                html += `
                    <div style="margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                        <div style="font-weight: 500;">${time.toLocaleTimeString()} - ${review.reviewer}</div>
                        <div style="color: var(--text-secondary);">${review.status}</div>
                    </div>
                `;
            });
            historyDiv.innerHTML = html;
        }

        function updateQueueDisplay() {
            const total = queueStatus.new + queueStatus.reviewing + queueStatus.escalated;
            document.getElementById('totalInQueue').textContent = total + ' emails';
            document.getElementById('newCount').textContent = queueStatus.new;
            document.getElementById('reviewCount').textContent = queueStatus.reviewing;
            document.getElementById('escalatedCount').textContent = queueStatus.escalated;
        }

        function saveShiftNotes() {
            const notes = {
                itemsReviewed: document.getElementById('itemsReviewed').value,
                unresolved: document.getElementById('unresolvedIssues').value,
                patterns: document.getElementById('suspiciousPatterns').value,
                timestamp: new Date(),
                shift: getCurrentShift()
            };
            
            localStorage.setItem('shiftNotes', JSON.stringify(notes));
            alert('Shift notes saved successfully');
            
            // Move to previous notes
            setTimeout(() => {
                document.getElementById('previousNotesContent').innerHTML = `
                    <strong>${notes.shift} - ${notes.timestamp.toLocaleString()}</strong><br>
                    Items: ${notes.itemsReviewed || 'None'}<br>
                    Unresolved: ${notes.unresolved || 'None'}<br>
                    Patterns: ${notes.patterns || 'None noted'}
                `;
            }, 100);
        }

        function getCurrentShift() {
            const hour = new Date().getHours();
            if (hour >= 7 && hour < 15) return 'Day Shift';
            if (hour >= 15 && hour < 23) return 'Evening Shift';
            return 'Night Shift';
        }

        function generateEmail(type) {
            const templates = {
                urgent: {
                    sender: 'dr.emergency@hospital.org',
                    subject: 'URGENT: Medical Emergency',
                    body: 'Immediate medical attention required for patient in ICU.'
                },
                safe: {
                    sender: 'admin@hospital.org',
                    subject: 'Staff Schedule Update',
                    body: 'Please review the updated schedule for next week.'
                },
                phishing: {
                    sender: 'security@fake-hospital.net',
                    subject: 'Account Verification Required',
                    body: 'Click here to verify your account or it will be suspended.'
                }
            };
            
            const email = templates[type];
            document.getElementById('genSender').textContent = email.sender;
            document.getElementById('genSubject').textContent = email.subject;
            document.getElementById('genBody').textContent = email.body;
            document.getElementById('generatedEmail').style.display = 'block';
            
            window.currentGeneratedEmail = email;
        }

        function loadGeneratedEmail() {
            if (window.currentGeneratedEmail) {
                document.getElementById('sender').value = window.currentGeneratedEmail.sender;
                document.getElementById('subject').value = window.currentGeneratedEmail.subject;
                document.getElementById('emailBody').value = window.currentGeneratedEmail.body;
                showTab('analysis');
            }
        }

        // Initialize dashboard
        updateQueueDisplay();
        initializeShiftDisplay();
        
        // Load review history from localStorage
        const savedReviewHistory = localStorage.getItem('reviewHistory');
        if (savedReviewHistory) {
            try {
                reviewHistory = JSON.parse(savedReviewHistory);
                updateReviewHistoryDisplay();
                
                // Show last review if it exists
                if (reviewHistory.length > 0) {
                    const lastReview = reviewHistory[0];
                    const time = new Date(lastReview.timestamp);
                    document.getElementById('lastReviewDetails').innerHTML = `
                        <strong style="color: #059669;">✓</strong> Reviewed by ${lastReview.reviewer} at ${time.toLocaleTimeString()}<br>
                        <span style="font-size: 0.8rem;">${lastReview.status}</span>
                    `;
                }
            } catch (e) {
                console.error('Error loading review history:', e);
            }
        }
        
        // Load previous shift notes if they exist
        const savedNotes = localStorage.getItem('shiftNotes');
        if (savedNotes) {
            const notes = JSON.parse(savedNotes);
            document.getElementById('previousNotesContent').innerHTML = `
                <strong>${notes.shift} - ${new Date(notes.timestamp).toLocaleString()}</strong><br>
                Items: ${notes.itemsReviewed || 'None'}<br>
                Unresolved: ${notes.unresolved || 'None'}<br>
                Patterns: ${notes.patterns || 'None noted'}
            `;
        }

        /**
         * Call backend API to analyze email content
         */
        async function analyzeEmailWithAPI(emailContent, context = 'general') {
            const resultsDiv = document.getElementById('analysisResults');
            const loadingDiv = document.getElementById('loadingIndicator');
            
            try {
                // Show loading state
                if (loadingDiv) loadingDiv.style.display = 'block';
                if (resultsDiv) resultsDiv.innerHTML = '<p>🔄 Analyzing email content...</p>';
                
                console.log('📤 Sending analysis request to backend');
                
                // Call local Express server API
                const response = await fetch('http://localhost:3000/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        emailContent: emailContent,
                        context: context
                    })
                });
                
                // Parse response
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Request failed');
                }
                
                console.log('✅ Received analysis result:', result);
                
                // Hide loading state
                if (loadingDiv) loadingDiv.style.display = 'none';
                
                // Display results
                if (result.success && result.data) {
                    displayAnalysisResults(result.data);
                } else {
                    throw new Error('Invalid response format');
                }
                
                return result.data;
                
            } catch (error) {
                console.error('❌ Analysis failed:', error);
                
                // Hide loading state
                if (loadingDiv) loadingDiv.style.display = 'none';
                
                // Display error message
                if (resultsDiv) {
                    resultsDiv.innerHTML = `
                        <div style="color: red; padding: 15px; border: 1px solid red; border-radius: 5px; background: #ffe6e6;">
                            <h3>❌ Analysis Failed</h3>
                            <p><strong>Error:</strong>${error.message}</p>
                            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                                Please check:<br>
                                • Network connection is normal<br>
                                • Server is running on http://localhost:3000<br>
                                • AWS Lambda endpoint is configured correctly
                            </p>
                        </div>
                    `;
                }
                
                throw error;
            }
        }

        /**
         * Display analysis results
         */
        function displayAnalysisResults(data) {
            const resultsDiv = document.getElementById('analysisResults');
            
            if (!resultsDiv) {
                console.error('Results display container #analysisResults not found');
                return;
            }
            
            // Helper function: escape HTML
            const escapeHtml = (text) => {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            };
            
            // Helper function: get urgency level display
            const getUrgencyDisplay = (level) => {
                const urgencyMap = {
                    'high': { emoji: '🔴', text: 'High', color: '#dc3545' },
                    'medium': { emoji: '🟡', text: 'Medium', color: '#ffc107' },
                    'low': { emoji: '🟢', text: 'Low', color: '#28a745' },
                    'routine': { emoji: '🟢', text: 'Routine', color: '#28a745' }
                };
                return urgencyMap[level] || { emoji: '⚪', text: 'Unknown', color: '#6c757d' };
            };
            
            const urgency = getUrgencyDisplay(data.urgencyLevel);
            
            const html = `
                <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-top: 20px;">
                    <h3 style="color: #28a745; margin-top: 0;">✅ Analysis Complete</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">🔒 Scrubbed Text</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff; white-space: pre-wrap; font-family: monospace; font-size: 14px;">
                            ${escapeHtml(data.scrubbedText || 'No content')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">🏥 Detected PHI Entities</h4>
                        ${(data.phiEntities && data.phiEntities.length > 0) ? `
                            <ul style="list-style: none; padding: 0;">
                                ${data.phiEntities.map(entity => `
                                    <li style="background: #e7f3ff; padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 4px solid #0066cc;">
                                        <strong style="color: #0066cc;">${escapeHtml(entity.Type || entity.type)}:</strong> 
                                        <span style="color: #333;">${escapeHtml(entity.Text || entity.text)}</span>
                                        <span style="color: #666; font-size: 12px; margin-left: 10px;">
                                            (Confidence: ${((entity.Score || entity.score || 0) * 100).toFixed(1)}%)
                                        </span>
                                    </li>
                                `).join('')}
                            </ul>
                        ` : '<p style="color: #666; padding: 10px; background: #f8f9fa; border-radius: 5px;">✓ No PHI entities detected</p>'}
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">⚡ Urgency Level</h4>
                        <div style="display: inline-block; padding: 10px 20px; background: ${urgency.color}; color: white; border-radius: 5px; font-weight: bold;">
                            ${urgency.emoji} ${urgency.text}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 0;">
                        <h4 style="color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px;">💡 Recommended Action</h4>
                        <p style="color: #333; padding: 10px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                            ${escapeHtml(data.recommendedAction || 'No special recommendations')}
                        </p>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // Check server connection on page load
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('🔍 Checking server connection...');
            try {
                const response = await fetch('http://localhost:3000/api/health');
                const health = await response.json();
                console.log('✅ Server health check passed:', health);
                
                if (!health.lambdaConfigured) {
                    console.warn('⚠️ AWS Lambda endpoint not configured, please set AWS_LAMBDA_ENDPOINT in .env file');
                }
            } catch (error) {
                console.error('❌ Unable to connect to backend server:', error);
                console.error('Please ensure server is running on http://localhost:3000');
            }
        });
    </script>
</body>
</html>