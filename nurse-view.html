<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nurse View - Healthcare Email Defense</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            font-size: 14px;
        }

        .top-bar {
            background: linear-gradient(135deg, #2c5aa0 0%, #1e3a8a 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .department {
            font-size: 0.9rem;
            opacity: 0.9;
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
        }

        .nav-icons {
            display: flex;
            gap: 20px;
        }

        .nav-icon {
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .nav-icon:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        .email-list-panel {
            width: 50%;
            background: white;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
            padding: 20px;
        }

        .email-list-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .email-list-header h2 {
            color: #2d3748;
            font-size: 1.5rem;
        }

        .email-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .email-card:hover {
            border-color: #2c5aa0;
            box-shadow: 0 4px 12px rgba(44, 90, 160, 0.1);
        }

        .email-card.selected {
            border-color: #2c5aa0;
            background: #ebf4ff;
        }

        .email-card.suspicious-urgent {
            border-left: 4px solid #f56565;
            background: #fff5f5;
        }

        .email-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .email-sender {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.95rem;
        }

        .email-timestamp {
            color: #718096;
            font-size: 0.85rem;
        }

        .email-subject {
            font-size: 1rem;
            color: #2d3748;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .email-labels {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .label {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .label.urgent {
            background: #dc3545;
            color: white;
        }

        .label.suspicious {
            background: white;
            color: #ff9800;
            border: 2px solid #ff9800;
        }

        .label.reported {
            background: #c6f6d5;
            color: #22543d;
            font-size: 0.7rem;
        }

        .confidence-score {
            font-size: 0.85rem;
            color: #718096;
        }

        .plugin-panel {
            width: 50%;
            background: white;
            padding: 30px;
            overflow-y: auto;
        }

        .plugin-panel.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0aec0;
            font-size: 1.1rem;
        }

        .plugin-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .plugin-header h2 {
            color: #2d3748;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .email-content-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }

        .email-content-header {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .email-content-header .email-field {
            margin-bottom: 10px;
        }

        .email-field-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .email-field-value {
            color: #2d3748;
            font-size: 0.95rem;
        }

        .email-body {
            margin-top: 15px;
            color: #2d3748;
            line-height: 1.8;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .detection-rationale {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 25px;
            color: #4a5568;
            line-height: 1.6;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-report {
            background: #007bff;
            color: white;
        }

        .btn-report:hover {
            background: #0056b3;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="user-info">
            <div class="user-name">üë©‚Äç‚öïÔ∏è Nurse Li</div>
            <div class="department">ER Department</div>
        </div>
        <div class="nav-icons">
            <div class="nav-icon" title="Inbox">üì•</div>
            <div class="nav-icon" title="Alerts">üîî</div>
            <div class="nav-icon" title="Profile">üë§</div>
        </div>
    </div>

    <div class="main-container">
        <div class="email-list-panel">
            <div class="email-list-header">
                <h2>üìß Inbox</h2>
            </div>
            <div id="emailList">
                <!-- Emails will be rendered here -->
            </div>
        </div>

        <div class="plugin-panel empty" id="pluginPanel">
            <div>Select an email to view detection details</div>
        </div>
    </div>

    <div class="toast" id="toast">
        Reported successfully. Awaiting review.
    </div>

    <script>
        // Mock emails data
        const emails = [
            {
                id: 'email1',
                sender: 'lab-report@medlab-info.com',
                subject: 'Lab Results: Patient #2387',
                timestamp: '2 hours ago',
                labels: ['Urgent', 'Suspicious'],
                confidence: 0.67,
                rationale: 'New domain detected; unverified link contained in message body.',
                status: 'suspicious',
                content: `Dear Healthcare Provider,

We have received lab results for Patient #2387 (Jane Doe, DOB: 05/15/1982).

URGENT: Abnormal test results detected.

Please review the attached report by clicking here: [View Results](https://medlab-info.com/results/verify?id=2387)

Critical values:
- Hemoglobin: 8.2 g/dL (Low - Normal: 12.0-15.5)
- Platelet count: 95,000/ŒºL (Low - Normal: 150,000-450,000)

Immediate action may be required. Please contact the lab if you have any questions.

Best regards,
Medical Lab Services
lab-report@medlab-info.com`
            },
            {
                id: 'email2',
                sender: 'billing@hospital.org',
                subject: 'Monthly Statement - October 2025',
                timestamp: '1 day ago',
                labels: [],
                confidence: 0.95,
                rationale: '',
                status: 'safe',
                content: `Dear Nurse Li,

Your monthly billing statement for October 2025 is now available.

Statement Summary:
- Total Charges: $2,450.00
- Insurance Coverage: $2,200.00
- Patient Responsibility: $250.00

Please review your statement in the patient portal.

If you have any questions, please contact our billing department.

Thank you,
Hospital Billing Department`
            },
            {
                id: 'email3',
                sender: 'nurse-chang@hospital.org',
                subject: 'Patient discharge notification',
                timestamp: '3 hours ago',
                labels: ['Urgent'],
                confidence: 0.88,
                rationale: '',
                status: 'safe',
                content: `Hi Nurse Li,

URGENT: Patient John Smith (Room 304) is ready for discharge.

Discharge Summary:
- Patient ID: #12345
- Room: 304
- Discharge Time: 3:00 PM today
- Transport Required: Yes

Please ensure all discharge paperwork is completed and patient belongings are ready.

Thanks,
Nurse Chang
ER Department`
            },
            {
                id: 'email4',
                sender: 'pharmacy@hospital.org',
                subject: 'Prescription ready for pickup',
                timestamp: '5 hours ago',
                labels: [],
                confidence: 0.92,
                rationale: '',
                status: 'safe',
                content: `Hello,

This is a notification that a prescription is ready for pickup at the hospital pharmacy.

Prescription Details:
- Patient: Sarah Johnson
- Prescription: Amoxicillin 500mg
- Quantity: 30 tablets
- Ready for pickup: Now

Please have the patient collect the prescription before the end of the day.

Thank you,
Hospital Pharmacy`
            }
        ];

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('emailState');
            if (saved) {
                const state = JSON.parse(saved);
                emails.forEach(email => {
                    if (state[email.id]) {
                        Object.assign(email, state[email.id]);
                    }
                });
            }
        }

        // Save state to localStorage
        function saveState() {
            const state = {};
            emails.forEach(email => {
                state[email.id] = {
                    status: email.status,
                    labels: email.labels
                };
            });
            localStorage.setItem('emailState', JSON.stringify(state));
        }

        // Render email list
        function renderEmailList() {
            const container = document.getElementById('emailList');
            container.innerHTML = emails.map(email => {
                const isSuspiciousUrgent = email.labels.includes('Urgent') && email.labels.includes('Suspicious');
                const isSelected = email.id === selectedEmailId;
                const hasReported = email.labels.includes('Reported');
                
                return `
                    <div class="email-card ${isSuspiciousUrgent ? 'suspicious-urgent' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="selectEmail('${email.id}')">
                        <div class="email-header">
                            <div class="email-sender">${email.sender}</div>
                            <div class="email-timestamp">${email.timestamp}</div>
                        </div>
                        <div class="email-subject">${email.subject}</div>
                        <div class="email-labels">
                            ${email.labels.map(label => {
                                if (label === 'Reported') {
                                    return `<span class="label reported">Reported by Nurse Li</span>`;
                                } else if (label === 'Urgent') {
                                    return `<span class="label urgent">Urgent</span>`;
                                } else if (label === 'Suspicious') {
                                    return `<span class="label suspicious">Suspicious</span>`;
                                }
                                return '';
                            }).join('')}
                        </div>
                        ${email.labels.includes('Suspicious') ? `<div class="confidence-score">Confidence Score: ${email.confidence}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        let selectedEmailId = null;

        function selectEmail(emailId) {
            selectedEmailId = emailId;
            const email = emails.find(e => e.id === emailId);
            
            renderEmailList();
            
            if (email) {
                renderPluginPanel(email);
            } else {
                renderEmptyPlugin();
            }
        }

        function renderPluginPanel(email) {
            const panel = document.getElementById('pluginPanel');
            panel.className = 'plugin-panel';
            
            const isSuspicious = email.labels.includes('Suspicious');
            const isUrgent = email.labels.includes('Urgent');
            
            panel.innerHTML = `
                <div class="plugin-header">
                    <h2>Email Content</h2>
                </div>
                <div class="email-content-section">
                    <div class="email-content-header">
                        <div class="email-field">
                            <div class="email-field-label">From:</div>
                            <div class="email-field-value">${email.sender}</div>
                        </div>
                        <div class="email-field">
                            <div class="email-field-label">Subject:</div>
                            <div class="email-field-value">${email.subject}</div>
                        </div>
                        <div class="email-field">
                            <div class="email-field-label">Received:</div>
                            <div class="email-field-value">${email.timestamp}</div>
                        </div>
                    </div>
                    <div class="email-body">
${email.content || 'No content available.'}
                    </div>
                </div>
                ${isSuspicious || isUrgent ? `
                    <div class="plugin-header">
                        <h2>Why flagged?</h2>
                    </div>
                    <div class="detection-rationale">
                        ${email.rationale || 'This email has been flagged for review.'}
                    </div>
                    <div class="action-buttons">
                        ${isSuspicious ? `
                            <button class="btn btn-report" onclick="reportEmail('${email.id}')">
                                Report to Department Lead & IT Director
                            </button>
                        ` : ''}
                    </div>
                ` : ''}
            `;
        }

        function renderEmptyPlugin() {
            const panel = document.getElementById('pluginPanel');
            panel.className = 'plugin-panel empty';
            panel.innerHTML = '<div>Select an email to view detection details</div>';
        }

        function reportEmail(emailId) {
            const email = emails.find(e => e.id === emailId);
            if (email) {
                email.status = 'reported';
                if (!email.labels.includes('Reported')) {
                    email.labels.push('Reported');
                }
                
                // Save to localStorage with notification info
                const reportData = {
                    status: 'reported',
                    notifiedRoles: ['lead', 'itDirector']
                };
                localStorage.setItem(`emailReport_${emailId}`, JSON.stringify(reportData));
                
                saveState();
                renderEmailList();
                
                // Show toast notification
                showToast();
            }
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize
        loadState();
        renderEmailList();
    </script>
</body>
</html>

